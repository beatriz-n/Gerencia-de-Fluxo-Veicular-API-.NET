@page "/veiculos"
@using FluxoVeicular.ServiceDefaults.Responses
@using FluxoVeicular.Web.ServiceApi
@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@* @inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject FluxoVeicular.Web.ServiceApi.VeiculoServiceApi VeiculoApi *@


<PageTitle>Veículos</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="pa-4">

    <MudGrid>
        <MudItem xs="6">
            <MudText Typo="Typo.h5" GutterBottom>Lista de Veículos</MudText>
        </MudItem>
        <MudItem xs="6" Class="d-flex justify-end">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/cadastroveiculo" StartIcon="@Icons.Material.Filled.Add">
                Novo Veículo
            </MudButton>
        </MudItem>
    </MudGrid>

    <MudTable Items="_veiculos" Hover="true" Bordered="true" Striped="true" Class="mt-4 d-flex justify-center">
        <HeaderContent>
        <MudTh>Placa</MudTh>
            <MudTh>Cor</MudTh>
            <MudTh Class="d-flex justify-center">Ações</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Placa">@context.Placa</MudTd>
        <MudTd DataLabel="Modelo">@context.Cor</MudTd>

        <MudTd DataLabel="Ações">

				        <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small"
                               OnClick="@(async () => await  ExcluirVeiculo(context.Id))" />
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                               OnClick="async () => await ExcluirVeiculo(context.Id)" />
        </MudTd>

    </RowTemplate>
</MudTable>


</MudContainer>

        @code{
    private List<VeiculoResponse> _veiculos = new();

    [Inject]
    public IDialogService DialogService { get; set; } = default!;

    // Adicione esta propriedade para injetar o serviço VeiculoApi
    [Inject]
    public VeiculoServiceApi VeiculoApi { get; set; } = default!;
    private void EditarVeiculo(Guid id)
    {
        Navigation.NavigateTo($"/veiculos/editar/{id}");
    }

    private async Task ExcluirVeiculo(Guid id)
    {
        Console.WriteLine($"[DEBUG] Clicou para excluir {id}");
        bool confirmado = await DialogService.ShowMessageBox(
            "Confirmação",
            "Tem certeza que deseja excluir este veículo?",
            yesText: "Sim", cancelText: "Não") == true;

        if (!confirmado) return;

        var sucesso = await VeiculoApi.DeleteVeiculoAsync(id);
        if (sucesso)
        {
            Snackbar.Add("Veículo excluído com sucesso.", Severity.Success);
            _veiculos = await VeiculoApi.GetVeiculosAsync();
            StateHasChanged();
        }
        else
        {
            Snackbar.Add("Erro ao excluir veículo.", Severity.Error);
        }
    }
    protected override async Task OnInitializedAsync()
    {
        _veiculos = await VeiculoApi.GetVeiculosAsync();
    }

        }